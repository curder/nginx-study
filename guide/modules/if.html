<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>if 条件判断 | Nginx 学习</title>
    <meta name="description" content="Nginx 学习记录">
    <link rel="preload stylesheet" href="/nginx-study/assets/style.6c70b17a.css" as="style">
    <link rel="modulepreload" href="/nginx-study/assets/app.24355d18.js">
    <link rel="modulepreload" href="/nginx-study/assets/guide_modules_if.md.8e1e45d4.lean.js">
    
    <link rel="icon" href="/nginx-study/images/favicon.ico">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-abcc630f><!--[--><!--]--><!--[--><span tabindex="-1" data-v-151f2593></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-151f2593> Skip to content </a><!--]--><!----><header class="VPNav" data-v-abcc630f data-v-0fa0e57d><div class="VPNavBar" data-v-0fa0e57d data-v-be450ad9><div class="container" data-v-be450ad9><div class="title" data-v-be450ad9><div class="VPNavBarTitle" data-v-be450ad9 data-v-6d2fb2d9><a class="title" href="/nginx-study/" data-v-6d2fb2d9><!--[--><!--]--><!--[--><img class="VPImage logo" src="/nginx-study/images/logo.svg" alt data-v-6db2186b><!--]--><!--[-->Nginx 学习<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-be450ad9><div class="curtain" data-v-be450ad9></div><div class="content-body" data-v-be450ad9><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-be450ad9 data-v-bdedfc22><span id="main-nav-aria-label" class="visually-hidden" data-v-bdedfc22>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/nginx-study/guide/install.html" data-v-bdedfc22 data-v-f2ec7ecf data-v-a8b5c975><!--[-->安装<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/nginx-study/guide/examples.html" data-v-bdedfc22 data-v-f2ec7ecf data-v-a8b5c975><!--[-->示例<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-be450ad9 data-v-da3f667a><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-da3f667a data-v-0d529b6d data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-0d529b6d><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-0d529b6d><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-be450ad9 data-v-2ab2a029 data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/curder/nginx-study" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-be450ad9 data-v-66bb1f24 data-v-96001b6b><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-96001b6b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-96001b6b><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-96001b6b><div class="VPMenu" data-v-96001b6b data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-66bb1f24><div class="item appearance" data-v-66bb1f24><p class="label" data-v-66bb1f24>Appearance</p><div class="appearance-action" data-v-66bb1f24><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-66bb1f24 data-v-0d529b6d data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-0d529b6d><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-0d529b6d><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-66bb1f24><div class="item social-links" data-v-66bb1f24><div class="VPSocialLinks social-links-list" data-v-66bb1f24 data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/curder/nginx-study" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-be450ad9 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><!----></header><!----><!----><div class="VPContent" id="VPContent" data-v-abcc630f data-v-fe5dac9b><div class="VPDoc has-aside" data-v-fe5dac9b data-v-ae7d01fc><div class="container" data-v-ae7d01fc><div class="aside" data-v-ae7d01fc><div class="aside-curtain" data-v-ae7d01fc></div><div class="aside-container" data-v-ae7d01fc><div class="aside-content" data-v-ae7d01fc><div class="VPDocAside" data-v-ae7d01fc data-v-cdc66372><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline has-outline" data-v-cdc66372 data-v-4414ac5c><div class="content" data-v-4414ac5c><div class="outline-marker" data-v-4414ac5c></div><div class="outline-title" data-v-4414ac5c>章节导航</div><nav aria-labelledby="doc-outline-aria-label" data-v-4414ac5c><span class="visually-hidden" id="doc-outline-aria-label" data-v-4414ac5c> Table of Contents for current page </span><ul class="root" data-v-4414ac5c data-v-1188541a><!--[--><li data-v-1188541a><a class="outline-link" href="#if-条件" data-v-1188541a>if 条件</a><!----></li><li data-v-1188541a><a class="outline-link" href="#break-指令" data-v-1188541a>break 指令</a><!----></li><li data-v-1188541a><a class="outline-link" href="#return-指令" data-v-1188541a>return 指令</a><!----></li><li data-v-1188541a><a class="outline-link" href="#rewrite-指令" data-v-1188541a>rewrite 指令</a><ul class="nested" data-v-1188541a data-v-1188541a><!--[--><li data-v-1188541a><a class="outline-link" href="#执行顺序" data-v-1188541a>执行顺序</a><!----></li><li data-v-1188541a><a class="outline-link" href="#flag-标识" data-v-1188541a>flag 标识</a><!----></li><!--]--></ul></li><li data-v-1188541a><a class="outline-link" href="#set-指令" data-v-1188541a>set 指令</a><!----></li><li data-v-1188541a><a class="outline-link" href="#举例" data-v-1188541a>举例</a><ul class="nested" data-v-1188541a data-v-1188541a><!--[--><li data-v-1188541a><a class="outline-link" href="#如果文件不存在返回-400" data-v-1188541a>如果文件不存在返回 400</a><!----></li><li data-v-1188541a><a class="outline-link" href="#当访问的文件和目录不存在时-重定向到某个php文件" data-v-1188541a>当访问的文件和目录不存在时，重定向到某个php文件</a><!----></li><li data-v-1188541a><a class="outline-link" href="#如果主机不是-example-com-则跳转到-example-com" data-v-1188541a>如果主机不是 example.com 则跳转到 example.com</a><!----></li><li data-v-1188541a><a class="outline-link" href="#如果请求类型不是-post-则返回-405" data-v-1188541a>如果请求类型不是 POST 则返回 405</a><!----></li><li data-v-1188541a><a class="outline-link" href="#如果请求参数中有-a-1-则-301-到其他域名" data-v-1188541a>如果请求参数中有 a=1 则 301 到其他域名</a><!----></li><li data-v-1188541a><a class="outline-link" href="#禁止访问以-sh-flv-mp3为后缀名的文件" data-v-1188541a>禁止访问以.sh,.flv,.mp3为后缀名的文件</a><!----></li><li data-v-1188541a><a class="outline-link" href="#禁止访问多个目录" data-v-1188541a>禁止访问多个目录</a><!----></li><li data-v-1188541a><a class="outline-link" href="#nginx-多重条件判断" data-v-1188541a>Nginx 多重条件判断</a><!----></li><!--]--></ul></li><li data-v-1188541a><a class="outline-link" href="#参考" data-v-1188541a>参考</a><!----></li><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-cdc66372></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-ae7d01fc><div class="content-container" data-v-ae7d01fc><!--[--><!--]--><main class="main" data-v-ae7d01fc><div style="position:relative;" class="vp-doc _nginx-study_guide_modules_if" data-v-ae7d01fc><div><h1 id="if-条件判断" tabindex="-1">if 条件判断 <a class="header-anchor" href="#if-条件判断" aria-hidden="true">#</a></h1><p>当需要判断文件不存在时、对不同的客户端IP执行不同的响应或请求路径符合某些条件时执行不同的逻辑，此时会需要用到 if 指令。</p><p>if 能在 server 或 location 段中使用，它的语法为：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">if (condition) { </span></span>
<span class="line"><span style="color:#A6ACCD;">    # ...</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h2 id="if-条件" tabindex="-1">if 条件 <a class="header-anchor" href="#if-条件" aria-hidden="true">#</a></h2><p>其中 condition 条件语法可以包括如下：</p><ul><li><p><strong>文件及目录匹配</strong></p><ul><li>使用 <code>=</code> 或者 <code>!=</code> 直接比较变量内容，<strong>注意不是 <code>==</code></strong></li><li>使用 <code>-f</code> 和 <code>!-f</code> 判断文件是否存在</li><li>使用 <code>-d</code> 和 <code>!-d</code> 判断目录是否存在</li><li>使用 <code>-e</code> 和 <code>!-e</code> 判断文件或目录是否存在</li><li>使用 <code>-x</code> 和 <code>!-x</code> 用来判断文件是否可执行</li></ul></li><li><p><strong>正则匹配</strong></p><ul><li><code>~</code> 区分大小写匹配指定正则表达式，当匹配时返回&quot;真&quot;</li><li><code>~*</code> 不区分大小写匹配指定正则表达式，当匹配时返回&quot;真&quot;</li><li><code>!~</code> 区分大小写匹配指定正则表达式，当不匹配时候返回&quot;真&quot;</li><li><code>!~*</code> 不区分大小写匹配指定正则表达式，当不匹配时候返回&quot;真&quot;</li></ul></li></ul><p>并且 if 指令不支持多条件、不支持嵌套且不支持 else。</p><h2 id="break-指令" tabindex="-1"><a href="http://nginx.org/r/break" target="_blank" rel="noreferrer">break 指令</a> <a class="header-anchor" href="#break-指令" aria-hidden="true">#</a></h2><p>遇到 <code>break</code> 则跳出，后面的指令不在执行，比如：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">if (!-f $reque_filename) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    set $id = 1; # 有效的指令</span></span>
<span class="line"><span style="color:#A6ACCD;">    break;</span></span>
<span class="line"><span style="color:#A6ACCD;">    limit_rate 10k; # 无效的指令</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h2 id="return-指令" tabindex="-1"><a href="http://nginx.org/r/return" target="_blank" rel="noreferrer">return 指令</a> <a class="header-anchor" href="#return-指令" aria-hidden="true">#</a></h2><p>完成对请求的处理，直接向客户端返回响应状态码。比如：</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-mV8EB" id="tab-m5mvXaZ" checked="checked"><label for="tab-m5mvXaZ">返回状态码和文本</label><input type="radio" name="group-mV8EB" id="tab-HshB_In"><label for="tab-HshB_In">返回状态码和URL</label><input type="radio" name="group-mV8EB" id="tab-0Q1KjdB"><label for="tab-0Q1KjdB">返回URL</label></div><div class="blocks"><div class="language-nginx active"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 格式如下：</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> code [text];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 示例1：直接返回状态码</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">403</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 示例2：拒绝没有有效身份验证令牌的请求时</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">401</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&quot;Access denied because token is expired or invalid&quot;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 格式如下： </span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> code URL;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 示例：重定向</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">301</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">scheme://www.example.com</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">request_uri;</span></span>
<span class="line"></span></code></pre></div><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 格式如下：</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> URL;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 示例：重定向</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">scheme://www.example.com</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">request_uri;</span></span>
<span class="line"></span></code></pre></div></div></div><p>参数解释如下：</p><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>code</td><td>返回给客户端的 HTTP 状态码</td></tr><tr><td>URL</td><td>返回给客户端的 URL 地址</td></tr><tr><td>text</td><td>返回给客户端的响应体内容，支持变量。</td></tr></tbody></table><p><code>return</code> 指令使用简单，适用于重定向满足条件的情况，重写的 URL 适用于匹配 server 或 location 块的每个请求，并且可以使用标准 <a href="http://nginx.org/en/docs/varindex.html" target="_blank" rel="noreferrer">NGINX 变量</a>构建重写的 URL。</p><h2 id="rewrite-指令" tabindex="-1"><a href="http://nginx.org/r/rewrite" target="_blank" rel="noreferrer">rewrite 指令</a> <a class="header-anchor" href="#rewrite-指令" aria-hidden="true">#</a></h2><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">rewrite</span><span style="color:#A6ACCD;"> regex replacement [flag]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>rewrite 指令使用指定的正则表达式 <code>regex</code> 来匹配请求的 URI，如果匹配成功，则使用 <code>replacement</code> 更改URI，指令会根据配置文件中的顺序来执行。</p><p>同时可以使用 flag 标识来终止指令的进一步处理。</p><p>如果替换字符串 replacement 以 <code>http://</code>、<code>https://</code> 或 <code>$scheme</code> 开头，则停止处理后续内容并直接重定向返回给客户端。</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-mNjvk" id="tab-Rlbrsu-" checked="checked"><label for="tab-Rlbrsu-">重写字符串以http://开头</label><input type="radio" name="group-mNjvk" id="tab-gMTsQ6e"><label for="tab-gMTsQ6e">重写字符串不以http://开头</label></div><div class="blocks"><div class="language-nginx active"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># 当匹配 正则表达式 /test/(.*)时 请求将被临时重定向到 http://www.$1.com</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># 相当于 flag 写为 redirect</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">rewrite</span><span style="color:#A6ACCD;"> /test/(.*) http://www.</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1.com</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&quot;ok&quot;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 在浏览器中输入 127.0.0.1:8080/test1/baidu </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 则临时重定向到 http://www.baidu.com</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 后面的 return 指令将没有机会执行了</span></span>
<span class="line"></span></code></pre></div><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">rewrite</span><span style="color:#A6ACCD;"> /test/(.*) www.</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1.com</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&quot;ok&quot;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 发送请求如下</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># curl 127.0.0.1:8080/test1/baidu</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># ok</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 此处没有带 http:// 所以只是简单的重写。请求的 uri 由 /test1/baidu 重写为 www.baidu.com</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 因为会顺序执行 rewrite 指令，所以下一步执行 return 指令响应了 ok 字符串</span></span>
<span class="line"></span></code></pre></div></div></div><p>注意重写表达式只对相对路径有效。如果需要配对主机名，应该使用 if 语句，示例如下：</p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> ( </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">host </span><span style="color:#89DDFF;">~* </span><span style="color:#A6ACCD;">www\.(.*) ) </span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#F07178;">   </span><span style="color:#89DDFF;"> set </span><span style="color:#F07178;">     </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">host_without_www</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">rewrite</span><span style="color:#F07178;">  </span><span style="color:#C3E88D;">^(.*)$</span><span style="color:#F07178;">  </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">scheme</span><span style="color:#F07178;">://</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">host_without_www</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">permanent</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="执行顺序" tabindex="-1">执行顺序 <a class="header-anchor" href="#执行顺序" aria-hidden="true">#</a></h3><ol><li><p>执行 server 块的 rewrite 指令</p></li><li><p>执行 location 匹配</p></li><li><p>执行选定的 location 中的 rewrite 指令</p></li></ol><p>如果其中某步中的 URI 被重写，则重新循环执行 1 - 3，直到找到真实存在的文件，如果循环超过10次，则返回 <strong>500 Internal Server Error</strong> 错误。</p><h3 id="flag-标识" tabindex="-1">flag 标识 <a class="header-anchor" href="#flag-标识" aria-hidden="true">#</a></h3><ul><li><p><code>last</code>： 相当于Apache的[L]标记，表示完成 <code>rewrite</code></p></li><li><p><code>break</code>： 停止执行当前虚拟主机的后续 <code>rewrite</code> 指令集</p></li><li><p><code>redirect</code>： 返回302临时重定向，地址栏会显示跳转后的地址</p></li><li><p><code>permanent</code>： 返回301永久重定向，地址栏会显示跳转后的地址</p></li></ul><blockquote><p><strong><code>last</code> 和 <code>break</code> 的区别</strong></p><ul><li><code>last</code> 一般写在 server 代码段和 if 条件判断中，而 <code>break</code> 一般使用在 location 中;</li><li><code>last</code> 不终止重写后的 url 匹配，即新的 url 会再从 server 走一遍匹配流程，而 <code>break</code> 终止重写后的匹配;</li><li><code>break</code> 和 <code>last</code> 都能组织继续执行后面的 <code>rewrite</code> 指令;</li></ul></blockquote><h2 id="set-指令" tabindex="-1"><a href="https://nginx.org/r/set" target="_blank" rel="noreferrer">set 指令</a> <a class="header-anchor" href="#set-指令" aria-hidden="true">#</a></h2><p>设置变量，语法如下：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">set $variable value;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>Nginx 支持的 http 变量实现在 <a href="https://github.com/nginx/nginx/blob/master/src/http/ngx_http_variables.c#L164" target="_blank" rel="noreferrer">ngx_http_variables.c</a> 的 <code>ngx_http_core_variables</code> 存储实现。</p><table><thead><tr><th>变量名</th><th>简单说明</th></tr></thead><tbody><tr><td><code>$arg_PARAMETER</code></td><td>这个变量包含GET请求中，如果有变量 PARAMETER 时的值</td></tr><tr><td><code>$args</code></td><td>这个变量等于请求行中的参数，同 <code>$query_string</code></td></tr><tr><td><code>$binary_remote_addr</code></td><td>二进制的客户地址</td></tr><tr><td><code>$body_bytes_sent</code></td><td>响应时送出的body字节数数量。即使连接中断，这个数据也是精确的</td></tr><tr><td><code>$content_length</code></td><td>请求头中的 <code>Content-length</code> 字段。</td></tr><tr><td><code>$content_type</code></td><td>请求头中的 <code>Content-Type</code> 字段。</td></tr><tr><td><code>$cookie_COOKIE</code></td><td>cookie COOKIE变量的值</td></tr><tr><td><code>$document_root</code></td><td>当前请求在 root 指令中指定的值。</td></tr><tr><td><code>$host</code></td><td>请求主机头字段，否则为服务器名称。</td></tr><tr><td><code>$http_user_agent</code></td><td>客户端 agent 信息</td></tr><tr><td><code>$http_cookie</code></td><td>客户端 cookie 信息</td></tr><tr><td><code>$limit_rate</code></td><td>这个变量可以限制连接速率。</td></tr><tr><td><code>$request_body_file</code></td><td>客户端请求主体信息的临时文件名</td></tr><tr><td><code>$request_method</code></td><td>客户端请求的动作，通常为 GET 或 POST 。</td></tr><tr><td><code>$remote_addr</code></td><td>客户端的 IP 地址，如果上层负载均衡的话可以尝试获取 <code>$http_x_forwarded_for</code> 的值</td></tr><tr><td><code>$remote_port</code></td><td>客户端的端口。</td></tr><tr><td><code>$remote_user</code></td><td>已经经过Auth Basic Module验证的用户名。</td></tr><tr><td><code>$request_completion</code></td><td>如果请求结束，设置为OK。当请求未结束或如果该请求不是请求链串的最后一个时为空</td></tr><tr><td><code>$request_filename</code></td><td>当前请求的文件路径，由 root 或 alias 指令与URI请求生成。</td></tr><tr><td><code>$scheme</code></td><td>HTTP方法（如http，https）。</td></tr><tr><td><code>$server_protocol</code></td><td>请求使用的协议，通常是HTTP/1.0或HTTP/1.1。</td></tr><tr><td><code>$server_addr</code></td><td>服务器地址，在完成一次系统调用后可以确定这个值。</td></tr><tr><td><code>$server_name</code></td><td>服务器名称。</td></tr><tr><td><code>$server_port</code></td><td>请求到达服务器的端口号。</td></tr><tr><td><code>$request_uri</code></td><td>包含请求参数的原始URI，不包含主机名，如：<code>/foo/bar.php?arg=baz</code>。</td></tr><tr><td><code>$uri</code></td><td>不带请求参数的当前URI，<code>$uri</code>不包含主机名，如 <code>/foo/bar.html</code>。</td></tr><tr><td><code>$document_uri</code></td><td>与 <code>$uri</code> 相同。</td></tr></tbody></table><p><a href="http://nginx.org/en/docs/varindex.html" target="_blank" rel="noreferrer">可以通过查看nginx 中内置的全局变量文档</a>获得更多详情。</p><h2 id="举例" tabindex="-1">举例 <a class="header-anchor" href="#举例" aria-hidden="true">#</a></h2><h3 id="如果文件不存在返回-400" tabindex="-1">如果文件不存在返回 400 <a class="header-anchor" href="#如果文件不存在返回-400" aria-hidden="true">#</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">if (!-f $request_filename) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    return 400;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h3 id="当访问的文件和目录不存在时-重定向到某个php文件" tabindex="-1">当访问的文件和目录不存在时，重定向到某个php文件 <a class="header-anchor" href="#当访问的文件和目录不存在时-重定向到某个php文件" aria-hidden="true">#</a></h3><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">if( !-</span><span style="color:#89DDFF;">e</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">request_filename ) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">rewrite</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">^/(.*)$</span><span style="color:#A6ACCD;"> index.php</span><span style="color:#89DDFF;"> last;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="如果主机不是-example-com-则跳转到-example-com" tabindex="-1">如果主机不是 example.com 则跳转到 example.com <a class="header-anchor" href="#如果主机不是-example-com-则跳转到-example-com" aria-hidden="true">#</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">if ($host != example.com) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    rewrite ^/(.*)$ https://example.com/$1 permanent;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h3 id="如果请求类型不是-post-则返回-405" tabindex="-1">如果请求类型不是 POST 则返回 405 <a class="header-anchor" href="#如果请求类型不是-post-则返回-405" aria-hidden="true">#</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">if ($request_method = POST) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    return 405;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h3 id="如果请求参数中有-a-1-则-301-到其他域名" tabindex="-1">如果请求参数中有 <code>a=1</code> 则 <code>301</code> 到其他域名 <a class="header-anchor" href="#如果请求参数中有-a-1-则-301-到其他域名" aria-hidden="true">#</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">if ($args ~ a=1) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    rewrite ^ http://example.com/ permanent;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h3 id="禁止访问以-sh-flv-mp3为后缀名的文件" tabindex="-1">禁止访问以<code>.sh</code>,<code>.flv</code>,<code>.mp3</code>为后缀名的文件 <a class="header-anchor" href="#禁止访问以-sh-flv-mp3为后缀名的文件" aria-hidden="true">#</a></h3><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.*\.(sh|flv|mp3)$ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">403</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="禁止访问多个目录" tabindex="-1">禁止访问多个目录 <a class="header-anchor" href="#禁止访问多个目录" aria-hidden="true">#</a></h3><p>禁止访问 cron 和 templates 开头的目录。</p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">^/(cron|templates)/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> deny </span><span style="color:#A6ACCD;">all</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">break;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="nginx-多重条件判断" tabindex="-1">Nginx 多重条件判断 <a class="header-anchor" href="#nginx-多重条件判断" aria-hidden="true">#</a></h3><p>nginx 的配置中不支持 if 条件的逻辑与／逻辑或运算 ，并且不支持 if 的嵌套语法。</p><ul><li><p><code>or</code> 或者</p><p>当站点或页面还没有上线，需要仅允许指定 IP 访问整站或特定URI，其他 IP 都返回 405 状态码。</p><p>针对上面的需求，Nginx 可以使用正则表达式，或者使用 set 指定定义变量。</p><p>比如访问者的 IP 是 <code>8.8.8.8</code> 或者 <code>114.114.114.114</code>时允许访问，其他 IP 访问则返回 405。</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-xreBP" id="tab-FEDx8yF" checked="checked"><label for="tab-FEDx8yF">正则表达式</label><input type="radio" name="group-xreBP" id="tab-hX1SwIx"><label for="tab-hX1SwIx">定义变量</label></div><div class="blocks"><div class="language-nginx active"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_ip </span><span style="color:#89DDFF;">!~ </span><span style="color:#C3E88D;">&quot;^(114|8)\.(114|8)\.(114|8)\.(114|8)$&quot;</span><span style="color:#A6ACCD;">) </span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">405</span><span style="color:#F07178;">;</span></span>
<span class="line"><span style="color:#F07178;">}</span></span>
<span class="line"></span></code></pre></div><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">set $</span><span style="color:#A6ACCD;">allow_ip </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_addr </span><span style="color:#89DDFF;">= </span><span style="color:#A6ACCD;">114.114.114.114) </span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#F07178;">   </span><span style="color:#89DDFF;"> set $</span><span style="color:#A6ACCD;">allow_ip</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">}</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_addr </span><span style="color:#89DDFF;">= </span><span style="color:#A6ACCD;">8.8.8.8) </span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#F07178;">   </span><span style="color:#89DDFF;"> set $</span><span style="color:#A6ACCD;">allow_ip</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">allow_ip </span><span style="color:#89DDFF;">!= </span><span style="color:#A6ACCD;">1) </span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">405</span><span style="color:#F07178;">;</span></span>
<span class="line"><span style="color:#F07178;">}</span></span>
<span class="line"></span></code></pre></div></div></div><p>以上是或者的关系，也就是多个条件中满足其一即可。</p></li><li><p><code>and</code> 并且</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-r9fte" id="tab-xY-wA4q" checked="checked"><label for="tab-xY-wA4q">使用数值类型</label><input type="radio" name="group-r9fte" id="tab-9Y7X34I"><label for="tab-9Y7X34I">使用字符串类型</label></div><div class="blocks"><div class="language-nginx active"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">set $</span><span style="color:#A6ACCD;">and </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (&lt;not condition&gt;) </span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#F07178;"> </span><span style="color:#89DDFF;"> set $</span><span style="color:#A6ACCD;">and</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (&lt;not condition&gt;) </span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#F07178;"> </span><span style="color:#89DDFF;"> set $</span><span style="color:#A6ACCD;">and</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">and) </span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#676E95;font-style:italic;"># ...</span></span>
<span class="line"><span style="color:#F07178;">}</span></span>
<span class="line"></span></code></pre></div><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">set $</span><span style="color:#A6ACCD;">and </span><span style="color:#C3E88D;">&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">if (&lt;condition&gt;) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    set </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">and </span><span style="color:#C3E88D;">&quot;0&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (&lt;condition&gt;) </span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#F07178;">   </span><span style="color:#89DDFF;"> set $</span><span style="color:#A6ACCD;">and</span><span style="color:#F07178;"> </span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">${</span><span style="color:#A6ACCD;">and</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">1&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">and </span><span style="color:#89DDFF;">= </span><span style="color:#C3E88D;">&quot;01&quot;</span><span style="color:#A6ACCD;">) </span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#676E95;font-style:italic;"># ...</span></span>
<span class="line"><span style="color:#F07178;">}</span></span>
<span class="line"></span></code></pre></div></div></div></li></ul><h2 id="参考" tabindex="-1">参考 <a class="header-anchor" href="#参考" aria-hidden="true">#</a></h2><p><a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html#if" target="_blank" rel="noreferrer">if 官方文档</a></p></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-ae7d01fc data-v-2813752b><div class="edit-info" data-v-2813752b><div class="edit-link" data-v-2813752b><a class="VPLink link edit-link-button" href="https://github.com/curder/nginx-study/edit/master/docs/guide/modules/if.md" target="_blank" rel="noreferrer" data-v-2813752b data-v-a8b5c975><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="edit-link-icon" data-v-2813752b><path d="M18,23H4c-1.7,0-3-1.3-3-3V6c0-1.7,1.3-3,3-3h7c0.6,0,1,0.4,1,1s-0.4,1-1,1H4C3.4,5,3,5.4,3,6v14c0,0.6,0.4,1,1,1h14c0.6,0,1-0.4,1-1v-7c0-0.6,0.4-1,1-1s1,0.4,1,1v7C21,21.7,19.7,23,18,23z"></path><path d="M8,17c-0.3,0-0.5-0.1-0.7-0.3C7,16.5,6.9,16.1,7,15.8l1-4c0-0.2,0.1-0.3,0.3-0.5l9.5-9.5c1.2-1.2,3.2-1.2,4.4,0c1.2,1.2,1.2,3.2,0,4.4l-9.5,9.5c-0.1,0.1-0.3,0.2-0.5,0.3l-4,1C8.2,17,8.1,17,8,17zM9.9,12.5l-0.5,2.1l2.1-0.5l9.3-9.3c0.4-0.4,0.4-1.1,0-1.6c-0.4-0.4-1.2-0.4-1.6,0l0,0L9.9,12.5z M18.5,2.5L18.5,2.5L18.5,2.5z"></path></svg> 编辑它<!--]--><!----></a></div><div class="last-updated" data-v-2813752b><p class="VPLastUpdated" data-v-2813752b data-v-355aa5ef>最后更新时间: <time datetime="2023-01-31T03:31:53.000Z" data-v-355aa5ef></time></p></div></div><!----></footer><!--[--><!--]--></div></div></div></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"snippets_var-index.md\":\"2d9f86be\",\"guide_examples.md\":\"b0048885\",\"guide_install.md\":\"4ff02c0e\",\"index.md\":\"d28c5f52\",\"readme.md\":\"cb5519e0\",\"guide_modules_if.md\":\"8e1e45d4\",\"guide_modules_index.md\":\"5f56a33d\"}")</script>
    <script type="module" async src="/nginx-study/assets/app.24355d18.js"></script>
    
  </body>
</html>